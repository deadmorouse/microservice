# Решение для организации инфраструктуры в микросервисной архитектуре

---

## Задача 1: Обеспечение процесса разработки (CI/CD)
**Выбранное решение:** **GitLab CI/CD + Docker + Kubernetes**

### Компоненты:
1. **GitLab** (облачная или self-hosted)
2. **Docker**
3. **Kubernetes/GitLab Runners**

### Обоснование выбора:
 **Git-репозитории** – отдельные репозитории для каждого сервиса  
 **CI/CD Pipeline** – поддержка триггеров:  
   - Автоматически (push/merge request)  
   - Вручную с параметрами (manual jobs)  
 **Гибкая конфигурация** – через `.gitlab-ci.yml` с шаблонами (`include`)  
 **Безопасность** – GitLab Variables + интеграция с HashiCorp Vault  
 **Мультиконфигурации** – правила через `rules`/`variables`  
 **Кастомные шаги** – произвольные скрипты в `script`  
 **Собственные образы** – задаются в `image:`  
 **Собственные раннеры** – развертывание на своих серверах/Kubernetes  
 **Параллелизм** – `parallel:` и разделение jobs/stages  

**Альтернативы:**  
- GitHub Actions + ArgoCD  
- Jenkins + Blue Ocean 

---

## Задача 2: Сбор и анализ логов
**Выбранное решение:** **EFK Stack (Elasticsearch + Fluentd/Fluent Bit + Kibana)**

### Компоненты:
1. **Fluentd/Fluent Bit** – сбор и транспортировка логов  
2. **Elasticsearch** – хранение и индексация  
3. **Kibana** – визуализация  

### Обоснование выбора:
 **Сбор из stdout** – поддержка Docker/Kubernetes логов  
 **Гарантированная доставка** – буферизация и ретраи  
 **Поиск/фильтрация** – Elasticsearch с полнотекстовым поиском  
 **Kibana UI** – сохраненные поиски и shared-ссылки  
 **Минимальное внедрение** – не требует изменений кода приложений  

**Альтернативы:**  
- Loki + Promtail + Grafana  
- Datadog/Splunk (SaaS))

---

## Задача 3: Мониторинг
**Выбранное решение:** **VictoriaMetrics + Grafana + Alertmanager**

### Компоненты:
1. **VictoriaMetrics** – сбор и хранение метрик
2. **Grafana** – визуализация и дашборды
3. **vmalert** – алертинг (аналог Alertmanager)
4. **Node Exporter** – метрики хостов
5. **cAdvisor** – метрики контейнеров

### Обоснование выбора:
 **Высокая производительность**  
 **Экономия ресурсов** – до 10x меньше памяти и дискового пространства  
 **Полная совместимость** с PromQL и форматом метрик Prometheus  
 **Горизонтальная масштабируемость** – кластерная версия VictoriaMetrics  
 **Долгосрочное хранение** – встроенная поддержка без необходимости дополнительных компонентов  
 **Простота развертывания**  

**Альтернативы:**
- Prometheus + Grafana
- Zabbix (классический мониторинг)

---

## Итоговая архитектура
| Компонент       | Решение                  |
|-----------------|--------------------------|
| **CI/CD**       | GitLab CI/CD + Kubernetes|
| **Логи**        | EFK Stack                |
| **Мониторинг**  | VictoriaMetrics + Grafana|
